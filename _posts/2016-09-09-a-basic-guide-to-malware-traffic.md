---
title: 'A Basic Guide to Malware Traffic Analysis Through Wireshark'
date: 2019-11-09T16:47:00+01:00
draft: false
---

  

[![](https://1.bp.blogspot.com/-EKeun-tQVZc/Xcbe9x1qlcI/AAAAAAAAD6s/9XVBHA4q6v4yndOLMOfhw70jlMd_HT9egCLcBGAsYHQ/s640/Malware.jpg)](https://1.bp.blogspot.com/-EKeun-tQVZc/Xcbe9x1qlcI/AAAAAAAAD6s/9XVBHA4q6v4yndOLMOfhw70jlMd_HT9egCLcBGAsYHQ/s1600/Malware.jpg)

  
In this tutorial, we will be collecting information on IOC ( Indication of Compromise) which include the following things :  

1.  Infected Files 
2.  URL/ Domains of the infected Site
3.  IP Address and port of the infected machine
4.  Mac address of the infected machine 

  
**Step 1:** Start Wireshark and select the interface whose packets you want to capture ( In our case we will be capturing Local Area Connection packets.  
  

[![](https://1.bp.blogspot.com/-B1b92qNvHok/XZS3FQxq45I/AAAAAAAAASE/kOi8pDSivlwMlaODaxH_2L5dWVBy9KXeQCPcBGAYYCw/s640/w1.png)](https://1.bp.blogspot.com/-B1b92qNvHok/XZS3FQxq45I/AAAAAAAAASE/kOi8pDSivlwMlaODaxH_2L5dWVBy9KXeQCPcBGAYYCw/s1600/w1.png)

  

Screen 1: Selecting the interface

  

  

[![](https://1.bp.blogspot.com/-Y1OBAIo3iFI/XZTYuESouQI/AAAAAAAAATc/k4YbxnXyoVc9_mDTBZUWJG_HqBynpFdnACLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B10.34.39%2BPM.png)](https://1.bp.blogspot.com/-Y1OBAIo3iFI/XZTYuESouQI/AAAAAAAAATc/k4YbxnXyoVc9_mDTBZUWJG_HqBynpFdnACLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B10.34.39%2BPM.png)

  

Screen 2: Captured packets after selecting interface

  

**Step 2**: Now we will see a whole lot of packets being captured so lets first sort the outputs we are getting and customise the results like adding up columns like source port , destination port, etc.

For that to figure out go to columns heading right click and select **Column Preferences.**

[![](https://1.bp.blogspot.com/-S_5-2Cvnafg/XZTZVCk4zQI/AAAAAAAAATk/Qj20pPA_hpsfHfIRqoo8UwJLteKTUvGIgCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B10.37.12%2BPM.png)](https://1.bp.blogspot.com/-S_5-2Cvnafg/XZTZVCk4zQI/AAAAAAAAATk/Qj20pPA_hpsfHfIRqoo8UwJLteKTUvGIgCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B10.37.12%2BPM.png)

  

Screen 3 : Clicking on Edit Column option

  

[![](https://1.bp.blogspot.com/-_2U9T2V2AO8/XZTZ0QgguXI/AAAAAAAAATs/0fZAkdr8tI4x4hkq-7E1CJjjrlOaHf-ZgCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B10.39.20%2BPM.png)](https://1.bp.blogspot.com/-_2U9T2V2AO8/XZTZ0QgguXI/AAAAAAAAATs/0fZAkdr8tI4x4hkq-7E1CJjjrlOaHf-ZgCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B10.39.20%2BPM.png)

Screen 4: Click on **\+** and adding columns.

  

Step 3 : Now add two columns naming Source port and Destination port and select type as **src port ( resolved)** and **Dest port (resolved )** respectively . Drag them and make it aligned with source ip and destination Ip so that it seems more convenient to identify which port was used and by which IP address. You can even remove the column if not needed by a simple uncheck option. Click on OK.

  

[![](https://1.bp.blogspot.com/-iJfezGFyMGw/XZTbcghLZcI/AAAAAAAAAT8/rlGFMARb19kjVECIEESdq0p8tz9kF7yNgCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B10.45.50%2BPM.png)](https://1.bp.blogspot.com/-iJfezGFyMGw/XZTbcghLZcI/AAAAAAAAAT8/rlGFMARb19kjVECIEESdq0p8tz9kF7yNgCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B10.45.50%2BPM.png)

Screen 5 : Final column Preferences 

  

**Step 4:** Change the Time display format in order to identify the Timestamp of the file being flowed over the network. To do this go to **View -> Time Display Format -> Date and Time of Day.**

[![](https://1.bp.blogspot.com/-dNJH_MFWeJM/XZTcUCLeJbI/AAAAAAAAAUI/pGiPcN1w74Aw2nQ0I4SFNCZQYbkXN2w8wCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B10.48.12%2BPM.png)](https://1.bp.blogspot.com/-dNJH_MFWeJM/XZTcUCLeJbI/AAAAAAAAAUI/pGiPcN1w74Aw2nQ0I4SFNCZQYbkXN2w8wCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B10.48.12%2BPM.png)

Screen 6 : Selecting Time Display Format

  

  

If we look at the panel now in Info we can see the requested URL but we are unable to check for the HOST through which it is being generated. To add that column we can either add it in the same way done in Step 3 or another way is through **Packet Detail Panel. **

**Step 5:** Click on any Packet in the Summary panel and click on any packet they go to its detail panel lookout for **HOST:** right-click and select ** Apply as a column**

[![](https://1.bp.blogspot.com/-UA03dTXNhyI/XZTevJ1HBLI/AAAAAAAAAUU/RPVyvnwwyO0bE4roaJKpLnDLBTtHwRFnwCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.00.14%2BPM.png)](https://1.bp.blogspot.com/-UA03dTXNhyI/XZTevJ1HBLI/AAAAAAAAAUU/RPVyvnwwyO0bE4roaJKpLnDLBTtHwRFnwCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.00.14%2BPM.png)

  

Screen 7 : Applying HOST  name as a Column

  

After doing this you will see a new column named as host.Now we want to see the request made through HTTP so for that we need to apply filter.

  

**Step 6 :** In the filter bar type http and press enter **OR** click on **Statistics -> Protocol Hierarchy -> Hypertext Transfer Protocol** right-click on it and click on **Apply as Filter -> Selected .** Click on Close

[![](https://1.bp.blogspot.com/-HGEEpm7-eJY/XZTgSu13JwI/AAAAAAAAAUg/kPu9GZEbgK8uY_XFQwINXWaTXDgYEoBXQCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.06.55%2BPM.png)](https://1.bp.blogspot.com/-HGEEpm7-eJY/XZTgSu13JwI/AAAAAAAAAUg/kPu9GZEbgK8uY_XFQwINXWaTXDgYEoBXQCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.06.55%2BPM.png)

  

Screen8: Applying HTTP as a filter

As we can now analyse all the HTTP traffic but we need to check for objects or files transmitted.

  

**Step 7:** Go to **File -> Export Objects -> HTTP **

[![](https://1.bp.blogspot.com/-TJ4EAl-uA4M/XZThDyIHnlI/AAAAAAAAAUo/erJGbtk0LtU2-A4ahVvEOGzlFEWev9rMgCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.09.55%2BPM.png)](https://1.bp.blogspot.com/-TJ4EAl-uA4M/XZThDyIHnlI/AAAAAAAAAUo/erJGbtk0LtU2-A4ahVvEOGzlFEWev9rMgCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.09.55%2BPM.png)

Screen 9 : Exporting all HTTP based Objects

  

**Step 8 :** Select the object you want to download like here in our example I am going to export to files which were downloaded on the system 192.168.220.164. Save it accordingly like the first file is Application/Force-download possibly it could be an exe so go to **Save ** -> name the file -> **Save .**

[![](https://1.bp.blogspot.com/-ADWkiy9GlN4/XZTi063PVQI/AAAAAAAAAU0/_VjhClNfzeIXpJxkOSJ_Fh5EnVy-bmUiACLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.16.23%2BPM.png)](https://1.bp.blogspot.com/-ADWkiy9GlN4/XZTi063PVQI/AAAAAAAAAU0/_VjhClNfzeIXpJxkOSJ_Fh5EnVy-bmUiACLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.16.23%2BPM.png)

  

Screen 10: Exporting the object in the Desktop for analysis. 

  

Now we have the file with us what we can do is either check that file through our anti-malware or navigate ourself to Virustotal.com (more preferable as it will show you the behavior of the file and it will be checked by the knowledge base of several anti-malwares. )

  

**Step 9 :** Upload the file in VirusTotal.com it will check for hashes and give you proper analysis.

  

[![](https://1.bp.blogspot.com/-Xb_UOodvFjs/XZTj9PL_jTI/AAAAAAAAAVA/Iie6AwCFCSkWBBGzddh8BkWI_BFnJGj_QCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.21.36%2BPM.png)](https://1.bp.blogspot.com/-Xb_UOodvFjs/XZTj9PL_jTI/AAAAAAAAAVA/Iie6AwCFCSkWBBGzddh8BkWI_BFnJGj_QCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.21.36%2BPM.png)

  

Screen 11 : Uploading the object/file in VirusTotal.com

  

  

[![](https://1.bp.blogspot.com/-W6TFbaUPJ_g/XZTkPhppCpI/AAAAAAAAAVI/AnUV9syulOcb1bzw3sqwp-Cs1h0O8xCGgCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.23.53%2BPM.png)](https://1.bp.blogspot.com/-W6TFbaUPJ_g/XZTkPhppCpI/AAAAAAAAAVI/AnUV9syulOcb1bzw3sqwp-Cs1h0O8xCGgCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.23.53%2BPM.png)

  

Screen 12: Results found by the calculated hash of that file 

  

For further knowledge on its behaviour you can head toward the behavior tab.

  

[![](https://1.bp.blogspot.com/-f2v8Tx5aeSA/XZTkyMzdVlI/AAAAAAAAAVU/e77nq-9RbvA8m5hrFpJxR4SuCs2YwxTIwCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.25.55%2BPM.png)](https://1.bp.blogspot.com/-f2v8Tx5aeSA/XZTkyMzdVlI/AAAAAAAAAVU/e77nq-9RbvA8m5hrFpJxR4SuCs2YwxTIwCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.25.55%2BPM.png)

  

Screen 13: Behaviour analysis of the HTTP object

  

Till this point we have gone through the most complex part of our tutorial ( which seems to be an easy one now ;) ) lets head towards finding out the other IOC's which we discussed earlier.

  

**Determining the Hostname of the Infected Website :** 

  

In the earlier tutorials, we have added a column **Host** in the column bar which will provide us the hostname or domain. Select the package and you will see the Host which provided the file.

  

[![](https://1.bp.blogspot.com/-RU-9yxBqX3I/XZTpJ4sig2I/AAAAAAAAAVg/qzIyKSp_ynMr1dqh2Tpau06O1xVUP1XdACLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.44.44%2BPM.png)](https://1.bp.blogspot.com/-RU-9yxBqX3I/XZTpJ4sig2I/AAAAAAAAAVg/qzIyKSp_ynMr1dqh2Tpau06O1xVUP1XdACLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.44.44%2BPM.png)

  

Screen 14: Select row shows you the HOST provided the file.

  

Determining the Internal Computer which downloaded the File for that just below the request sequence ( the selected one) we see something getting done on port 80 which is that application file.

The destination in this case will be an infected computer and source will be the domain from where it is downloaded. 

  

[![](https://1.bp.blogspot.com/-1ss3pb6GrC0/XZTqZ9v9qWI/AAAAAAAAAVw/4wQeUjkC-O8CpBPSmXgKNGvlz9ag7FPagCLcBGAsYHQ/s640/Screenshot%2B2019-10-02%2Bat%2B11.50.03%2BPM.png)](https://1.bp.blogspot.com/-1ss3pb6GrC0/XZTqZ9v9qWI/AAAAAAAAAVw/4wQeUjkC-O8CpBPSmXgKNGvlz9ag7FPagCLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.50.03%2BPM.png)

  

Screen 15 : Application downloaded on IP 192.168.220.164 

  

The last thing we need to find about the infected machine is it's MAC address so for that have a close look on the Packet Detail panel below the summary panel click on the **Ethernet II** where you will be seeing **SRC: and Dst:**

[![](https://1.bp.blogspot.com/-tVEiX40Fv18/XZTrynKD-8I/AAAAAAAAAWA/1j9A7BlYAcU1y94tY31DXIBjutwuZ1RAACLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.56.04%2BPM.png)](https://1.bp.blogspot.com/-tVEiX40Fv18/XZTrynKD-8I/AAAAAAAAAWA/1j9A7BlYAcU1y94tY31DXIBjutwuZ1RAACLcBGAsYHQ/s1600/Screenshot%2B2019-10-02%2Bat%2B11.56.04%2BPM.png)

Screen 16 : **DST: ** will show you the MAC address of the the infected computer

  

  

Finally, we have found out the major IOC elements with the help of wireshark. For further learning, I have uploaded the file here itself so that you can perform operations in this saved pcap file.

PCAP File Download Link: [https://gofile.io/?c=YCLTnQ](https://gofile.io/?c=YCLTnQ)

  

For more such samples you can prefer going to: [https://wiki.wireshark.org/SampleCaptures](https://wiki.wireshark.org/SampleCaptures)